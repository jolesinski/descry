model: object_13
scene: T_07_willow_dataset

keypoints:
  - &model-iss
    type: iss-cupcl
    salient-radius: 0.02
    non-max-radius: 0.02
    lambda-ratio-21: 0.9
    lambda-ratio-32: 0.2
    lambda-threshold-3: 1e-6
    min-neighbours: 10
  - &scene-iss
    type: iss-cupcl
    salient-radius: 0.005
    non-max-radius: 0.01
    lambda-ratio-21: 0.9
    lambda-ratio-32: 0.2
    lambda-threshold-3: 1e-6
    min-neighbours: 10

feature-matching:
  - &orb-matching
    description:
      model:
        features:
          type: orb
          max-features: 500
#        viewer:
#          show-only: [7]
#          show-2d: true
      scene:
        features:
          type: orb
          max-features: 5000
    matcher:
      type: brute-force
      norm: hamming
      use-lowe: true
      lowe-ratio: 0.8
  - &shot-matching
    description:
      model:
        keypoints: *model-iss
        reference-frames:
          type: board
          find-holes: true
          support-radius: 0.015
        features:
          type: shot
          support-radius: 0.015
          threads: 4
      scene:
        keypoints: *scene-iss
        reference-frames:
          type: board
          find-holes: true
          support-radius: 0.015
        features:
          type: shot
          support-radius: 0.015
          threads: 4
    matcher:
      type: kdtree-flann
      max-neighs: 1
      max-distance: 0.15

refiners:
  - &icp
    type: icp
    max-iterations: 5
    max-correspondence-distance: 0.005
    transformation-epsilon: 1e-5
    euclidean-fitness: 1
    use-reciprocal: false
#    viewer: true

verifiers:
  - &papazov
    type: papazov
    resolution: 0.005
  # squared? radius of in scene model inliers
    inlier-threshold: 0.01
  # min scene indices that are neighbours to visible model to full model ratio
    support-threshold: 0.2
  # max visible model outliers (no scene neighbour) to full model size
    penalty-threshold: 0.1
  # number of scene indices that are neighbours to both models to either full model ratio
    conflict-threshold: 0.001
  #  viewer: true
  - &global
    type: global
    resolution: 0.01
    inlier-threshold: 0.1
    occlusion-threshold: 0.01
    regularizer: 3.0
    detect-clutter: true
    clutter-radius: 0.05
    clutter-regularizer: 5.0
    radius-normals: 0.05
  #  viewer: true

recognizer:
  preprocess:
    normals:
      type: cupcl
      support-radius: 0.02
      #viewer: true
  aligner:
    type: sparse
    matching:
      - *orb-matching
      - *shot-matching
    clusters:
      type: gc
      gc-size: 0.01
      gc-threshold: 5
#      viewer:
#        show-matches: true
#        show-once: false
#        show-empty: true
##        show-only: [7, 8, 9]
#        show-2d: true
#        keypoint-size: 5
    viewer: true
  #refinement: *icp
  verification: *papazov

metrics:
  radius: 0.01
  visualize: false